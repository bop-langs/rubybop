sudo: required
dist: trusty

language: c

compiler:
  - gcc-5
  - clang-3.8

os:
  - linux
  #- osx
env:
  - BOP_GroupSize=2
  - BOP_GroupSize=4 #normal understudy, more PPR tasks
matrix:
  fast_finish: true
#dependencies for the ruby language
exclude:
  - os: osx
    env: BOP_UndyFinish=0 BOP_GroupSize=4

addons:
  apt:
    sources:
    # add PPAs with more up-to-date toolchains
    - ubuntu-toolchain-r-test
    - llvm-toolchain-precise-3.6
    packages:
    # install toolchains
    - gcc-5
    - clang-3.8
#Change ssh addresses to the https equivalents on the fly
git:
  submodules: false
before_install:
  - sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
  - git submodule update --init
  - cd cbop && sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules && git submodule update --init && cd -
  - "if [[ $TRAVIS_OS_NAME = 'linux' ]]; then JOBS='-j'; fi"
  - "if [[ $TRAVIS_OS_NAME = 'osx' ]]; then brew install autoconf openssl; fi"
  - "if [[ $TRAVIS_OS_NAME = 'osx' ]]; then OPENSSL_FLAG=\"--with-openssl-dir=`brew --prefix openssl`\"; fi"
  - "if [[ $TRAVIS_OS_NAME = 'osx' && $CC = 'gcc' ]]; then CC='gcc-4.9'; fi"

before_script: #before tests run
  - "if [[ $TRAVIS_OS_NAME = 'osx' ]]; then rm -f ~/Library/Logs/DiagnosticReports/ruby_*.crash; fi"

notifications:
  webhooks:
    urls:
      - https://webhooks.gitter.im/e/1c946d1121b3d537d93d
    on_success: change
    on_failure: always
    on_start: never

#test script
script:
  - make && make test
