task :default => :ruby_setup

task :ruby_setup do
  cd "ruby" do
    if (!File.exists?("Makefile")) then
      sh 'autoconf'
      sh './configure'
    end
	sh 'make'
  end
end

task :ruby_tests => :ruby_setup do
  cd "ruby" do
	sh 'make test' do |ok, res|
		if res.exitstatus != 0
			fail 'tests failed'
  end
end

task :clean
  cd "ruby" do
    sh 'make clean'
	end
end
