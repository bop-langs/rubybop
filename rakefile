task :
default => :
build

task :
build => :
bop do
#build ruby
    cd "ruby" do
        if (!File.exists?("Makefile")) then
            sh 'autoconf'
            sh './configure'
            end
            sh 'make'
            end
            end

            task :
            bop do
#build bop
                cd "bop" do
                    sh 'gcc -I. -Wall -O3 *.c -c'
                    end
                    end

task :
test => :
                    build do
                        cd "ruby" do
                            sh 'make test' do |ok, res|
                                if ! ok then
                                fail "tests failed (status = #{res.exitstatus}"
                                end
                                end
                                end
                                end

task :
                                clean do
                                    cd "ruby" do
                                        if(File.exists?("Makefile")) then
                                                sh 'make clean'
                                                end
                                                end
                                                cd "bop" do
                                                    sh 'rm -f *.o'
                                                    end
                                                    end
