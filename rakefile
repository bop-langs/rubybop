task :default => :ruby_setup

task :ruby_setup do
  cd "ruby" do
    if (!File.exists?("Makefile")) then
      sh 'autoconf'
      sh './configure'
    end
		sh 'make'
  end
end

task :test => :ruby_setup do
  cd "ruby" do
		sh 'make test' do |ok, res|
			if ! ok
				fail "tests failed (status = #{res.exitstatus}"
			end
		end
	end
end

task :clean do
	cd "ruby" do
		if(File.exists?("Makefile")) then
			sh 'make clean'
		end
	end
end
